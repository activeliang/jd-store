<div class="container">
  <h1>商店大赛加油站收银台</h1>

    <div class="pay-alert">
      <img src="https://pay.djicdn.com/assets/order/create-success-3923f23be32c9caabe84cc5e107667d11f2248d13b7e8249171f2bd84494d95d.png" alt="Create success">
      <h4>订单提交成功，请尽快完成付款~</h4>
      <div class="row">
        <div class="col-ms-6">
          <p>订单号:<%= @order %></p>
        </div>
        <div class="col-sm-6">
          应付金额：￥ <%= @payment.total_money %>
        </div>
      </div>

    </div>

    <div class="line"></div>

    <div class="payment-btn">
      <%= link_to create_payment_payment_path(@payment.payment_no), class: "payment-btn btn btn-primary", id: "payha" do %>
      <div class="alipay-img"><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-05-29-073726.jpg" alt=""></div>
      <h3><i style="display: none;" class="fa fa-spinner payment-btn-1 fa-spin fa-fw"></i>使用支付宝付款</h3>
      <% end %>
      </div>

<div class="pay-counter-bc">
  <div class="pay-counter container-fluid">
    <div class="pay-counter-nav">
      <h3>商店大赛加油站<span></span>收银台</h3>
    </div>
    <p>正在使用即时到账交易</p>
    <h3><%= @payment.payment_no %></h3><span>收款方：商店大赛加油站...</span>

    <div class="payment-counter-bc-2">
      <div class="bc-2">
        <p>扫一扫付款（元）</p>
        <h3 class="pay-total"><%= @payment.total_money %></h3>
        <div class="bc-2-2">
          <div id="pay_qrcode"></div>
          <img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-05-29-53.png" alt="alipay">
          <div class="bc-2-3">
            <img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-05-29-T1bdtfXfdiXXXXXXXX.png" alt="扫一扫">
            <div>
              <p>打开手机支付宝</p>
              <p>扫一扫继续付款</p>
            </div>
          </div>
        </div>
      </div>
      <p><a href="https://mobile.alipay.com/index.htm">首次使用请下载手机支付宝</a></p>
      <p class="pay-alert-1">提示：付款后，通常会在10秒内跳转页面~请耐心等候~</p>
    </div>
    <div class="payment-counter-bc-3">
      <img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-05-29-083857.jpg" alt="扫一扫">
      <img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-05-29-083957.jpg" alt="扫一扫">
    </div>


</div>

  </div>
  <div id="mytest"></div>

</div>
<!-- overlay -->
<div id="overlay">
  <div id="text">
  <i  class="fa fa-spinner fa-spin fa-fw"></i>正在加载中…
  </div>
</div>

<script>

$(".payment-btn").click(function(){
  $(".payment-btn-1").css("display", "block");
  setTimeout(function () {

    $("#overlay").fadeIn("display", "block"),
    $(".payment-btn-1").css("display", "none")
  }, 1000);
})


function clock()
  {
    $.ajax({
      url: "/payments/test",
      method: "POST",
      data: { order: "<%= @raw_order %>" },
      dataType: "json",
      success: function(data){
      status = data["liang"];
      // alert(data["liang"]);
      if ( status == 1 || status == 2 )
        {
          window.location.href='/payments/success';
        }
      }
    })
  }

$(".payment-btn").click(function(evt){
  event.preventDefault();

  var url = $(this).attr("href");
  var that = this;

    $.ajax({
      url: url,
      method: "POST",
      dataType: "json",
      success: function(data){
      $("#pay_qrcode").html("<%=j raw @qr.as_html %>");
      }
    });
      var int=self.setInterval("clock()",1000);
  })


</script>
